-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | Prefetch packages
--   
--   Prefetch packages
@package nvfetcher
@version 0.1.0.0

module Development.NvFetcher.Types

-- | Package version
newtype Version
Version :: Text -> Version

-- | SHA 256 sum
newtype SHA256
SHA256 :: Text -> SHA256

-- | The input of nvchecker
data VersionSource
GitHubRelease :: Text -> Text -> VersionSource
[owner] :: VersionSource -> Text
[repo] :: VersionSource -> Text
Git :: Text -> VersionSource
[vurl] :: VersionSource -> Text
Pypi :: Text -> VersionSource
[pypi] :: VersionSource -> Text
ArchLinux :: Text -> VersionSource
[archpkg] :: VersionSource -> Text
Aur :: Text -> VersionSource
[aur] :: VersionSource -> Text
Manual :: Text -> VersionSource
[manual] :: VersionSource -> Text
Repology :: Text -> Text -> VersionSource
[repology] :: VersionSource -> Text
[repo] :: VersionSource -> Text

-- | The result of running nvchecker
data NvcheckerResult
NvcheckerResult :: Version -> Maybe Version -> NvcheckerResult
[nvNow] :: NvcheckerResult -> Version

-- | nvchecker doesn't give this value, but shake restores it from last run
[nvOld] :: NvcheckerResult -> Maybe Version

-- | Package fetcher if the package is prefetched, then we can obtain the
--   SHA256
data NixFetcher (k :: Prefetch)
FetchGit :: Text -> Version -> Maybe Text -> Bool -> Bool -> Bool -> MapPrefetch k -> NixFetcher (k :: Prefetch)
[furl] :: NixFetcher (k :: Prefetch) -> Text
[rev] :: NixFetcher (k :: Prefetch) -> Version
[branch] :: NixFetcher (k :: Prefetch) -> Maybe Text
[deepClone] :: NixFetcher (k :: Prefetch) -> Bool
[fetchSubmodules] :: NixFetcher (k :: Prefetch) -> Bool
[leaveDotGit] :: NixFetcher (k :: Prefetch) -> Bool
[sha256] :: NixFetcher (k :: Prefetch) -> MapPrefetch k
FetchUrl :: Text -> MapPrefetch k -> NixFetcher (k :: Prefetch)
[furl] :: NixFetcher (k :: Prefetch) -> Text
[sha256] :: NixFetcher (k :: Prefetch) -> MapPrefetch k

-- | Prefetch status
data Prefetch
Fresh :: Prefetch
Prefetched :: Prefetch

-- | Package name, used in generating nix expr
type PackageName = Text

-- | How to create package source fetcher given a version
type PackageFetcher = Version -> NixFetcher Fresh

-- | A package is defined with its name, how to track its version, and how
--   to fetch it as we have version
data Package
Package :: PackageName -> VersionSource -> PackageFetcher -> Package
[pname] :: Package -> PackageName
[pversion] :: Package -> VersionSource
[pfetcher] :: Package -> PackageFetcher
instance Control.DeepSeq.NFData Development.NvFetcher.Types.Version
instance Data.Binary.Class.Binary Development.NvFetcher.Types.Version
instance Data.Hashable.Class.Hashable Development.NvFetcher.Types.Version
instance GHC.Generics.Generic Development.NvFetcher.Types.Version
instance Data.Aeson.Types.ToJSON.ToJSON Development.NvFetcher.Types.Version
instance Data.Aeson.Types.FromJSON.FromJSON Development.NvFetcher.Types.Version
instance GHC.Base.Monoid Development.NvFetcher.Types.Version
instance GHC.Base.Semigroup Development.NvFetcher.Types.Version
instance Data.String.IsString Development.NvFetcher.Types.Version
instance GHC.Classes.Ord Development.NvFetcher.Types.Version
instance GHC.Show.Show Development.NvFetcher.Types.Version
instance GHC.Classes.Eq Development.NvFetcher.Types.Version
instance Control.DeepSeq.NFData Development.NvFetcher.Types.SHA256
instance Data.Binary.Class.Binary Development.NvFetcher.Types.SHA256
instance Data.Hashable.Class.Hashable Development.NvFetcher.Types.SHA256
instance GHC.Generics.Generic Development.NvFetcher.Types.SHA256
instance GHC.Classes.Eq Development.NvFetcher.Types.SHA256
instance GHC.Show.Show Development.NvFetcher.Types.SHA256
instance Control.DeepSeq.NFData Development.NvFetcher.Types.VersionSource
instance Data.Binary.Class.Binary Development.NvFetcher.Types.VersionSource
instance Data.Hashable.Class.Hashable Development.NvFetcher.Types.VersionSource
instance GHC.Generics.Generic Development.NvFetcher.Types.VersionSource
instance GHC.Classes.Eq Development.NvFetcher.Types.VersionSource
instance GHC.Show.Show Development.NvFetcher.Types.VersionSource
instance Control.DeepSeq.NFData Development.NvFetcher.Types.NvcheckerResult
instance Data.Binary.Class.Binary Development.NvFetcher.Types.NvcheckerResult
instance Data.Hashable.Class.Hashable Development.NvFetcher.Types.NvcheckerResult
instance GHC.Generics.Generic Development.NvFetcher.Types.NvcheckerResult
instance GHC.Classes.Eq Development.NvFetcher.Types.NvcheckerResult
instance GHC.Show.Show Development.NvFetcher.Types.NvcheckerResult
instance GHC.Generics.Generic (Development.NvFetcher.Types.NixFetcher k)
instance GHC.Show.Show (Development.NvFetcher.Types.MapPrefetch k) => GHC.Show.Show (Development.NvFetcher.Types.NixFetcher k)
instance GHC.Classes.Eq (Development.NvFetcher.Types.MapPrefetch k) => GHC.Classes.Eq (Development.NvFetcher.Types.NixFetcher k)
instance Data.Hashable.Class.Hashable (Development.NvFetcher.Types.MapPrefetch k) => Data.Hashable.Class.Hashable (Development.NvFetcher.Types.NixFetcher k)
instance Data.Binary.Class.Binary (Development.NvFetcher.Types.MapPrefetch k) => Data.Binary.Class.Binary (Development.NvFetcher.Types.NixFetcher k)
instance Control.DeepSeq.NFData (Development.NvFetcher.Types.MapPrefetch k) => Control.DeepSeq.NFData (Development.NvFetcher.Types.NixFetcher k)
instance GHC.Show.Show Development.NvFetcher.Types.Package
instance GHC.Classes.Eq Development.NvFetcher.Types.Package
instance GHC.Classes.Ord Development.NvFetcher.Types.Package
instance Data.Aeson.Types.FromJSON.FromJSON Development.NvFetcher.Types.NvcheckerResult

module Development.NvFetcher.Nvchecker

-- | The input of nvchecker
data VersionSource
GitHubRelease :: Text -> Text -> VersionSource
[owner] :: VersionSource -> Text
[repo] :: VersionSource -> Text
Git :: Text -> VersionSource
[vurl] :: VersionSource -> Text
Pypi :: Text -> VersionSource
[pypi] :: VersionSource -> Text
ArchLinux :: Text -> VersionSource
[archpkg] :: VersionSource -> Text
Aur :: Text -> VersionSource
[aur] :: VersionSource -> Text
Manual :: Text -> VersionSource
[manual] :: VersionSource -> Text
Repology :: Text -> Text -> VersionSource
[repology] :: VersionSource -> Text
[repo] :: VersionSource -> Text

-- | Rules of nvchecker
nvcheckerRule :: Rules ()

-- | Run nvchecker
checkVersion :: VersionSource -> Action NvcheckerResult

module Development.NvFetcher.NixFetcher

-- | Package fetcher if the package is prefetched, then we can obtain the
--   SHA256
data NixFetcher (k :: Prefetch)
FetchGit :: Text -> Version -> Maybe Text -> Bool -> Bool -> Bool -> MapPrefetch k -> NixFetcher (k :: Prefetch)
[furl] :: NixFetcher (k :: Prefetch) -> Text
[rev] :: NixFetcher (k :: Prefetch) -> Version
[branch] :: NixFetcher (k :: Prefetch) -> Maybe Text
[deepClone] :: NixFetcher (k :: Prefetch) -> Bool
[fetchSubmodules] :: NixFetcher (k :: Prefetch) -> Bool
[leaveDotGit] :: NixFetcher (k :: Prefetch) -> Bool
[sha256] :: NixFetcher (k :: Prefetch) -> MapPrefetch k
FetchUrl :: Text -> MapPrefetch k -> NixFetcher (k :: Prefetch)
[furl] :: NixFetcher (k :: Prefetch) -> Text
[sha256] :: NixFetcher (k :: Prefetch) -> MapPrefetch k

-- | Prefetch status
data Prefetch
Fresh :: Prefetch
Prefetched :: Prefetch

-- | Types can be converted into nix expr
class ToNixExpr a
toNixExpr :: ToNixExpr a => a -> Text

-- | Rules of nix fetcher
prefetchRule :: Rules ()

-- | Create a fetcher from github repo
gitHubFetcher :: (Text, Text) -> PackageFetcher

-- | Create a fetcher from pypi
pypiFetcher :: Text -> PackageFetcher

-- | Create a fetcher from github release
gitHubReleaseFetcher :: (Text, Text) -> Text -> PackageFetcher

-- | Create a fetcher from git url
gitFetcher :: Text -> PackageFetcher

-- | Create a fetcher from url
urlFetcher :: Text -> NixFetcher Fresh

-- | Run nix fetcher
prefetch :: NixFetcher Fresh -> Action (NixFetcher Prefetched)
instance Development.NvFetcher.NixFetcher.ToNixExpr (Development.NvFetcher.Types.NixFetcher 'Development.NvFetcher.Types.Fresh)
instance Development.NvFetcher.NixFetcher.ToNixExpr (Development.NvFetcher.Types.NixFetcher 'Development.NvFetcher.Types.Prefetched)
instance Development.NvFetcher.NixFetcher.ToNixExpr GHC.Types.Bool
instance Development.NvFetcher.NixFetcher.ToNixExpr Development.NvFetcher.Types.Version

module Development.NvFetcher.PackageSet

-- | Package set is a free monad equipped with two capabilities:
--   
--   <ol>
--   <li>Carry defined packages</li>
--   <li>Run shake actions</li>
--   </ol>
--   
--   Consturct it using <a>newPackage</a> and <a>embedAction</a>
type PackageSet = Free PackageSetF

-- | Add a package to package set
newPackage :: PackageName -> VersionSource -> PackageFetcher -> PackageSet ()

-- | Lift a shake <a>Action</a> to package set
embedAction :: Action a -> PackageSet a

-- | Add a list of packages into package set
purePackageSet :: [Package] -> PackageSet ()

-- | Run package set into a set of packages, carried by <a>Action</a>
runPackageSet :: PackageSet a -> Action (Set Package)

-- | A tagless final style DSL for constructing packages
class PkgDSL f
new :: PkgDSL f => f PackageName -> f (Prod '[PackageName])
andThen :: PkgDSL f => f (Prod r) -> f a -> f (Prod (a : r))
end :: (PkgDSL f, Member PackageName r, Member VersionSource r, Member PackageFetcher r) => f (Prod r) -> f ()
define :: (Member PackageName r, Member VersionSource r, Member PackageFetcher r) => PackageSet (Prod r) -> PackageSet ()

-- | Start chaining with the name of package to define
package :: PackageName -> PackageSet (Prod '[PackageName])

-- | Attach version sources
src :: PackageSet (Prod r) -> VersionSource -> PackageSet (Prod (VersionSource : r))

-- | Attach fetchers
fetch :: PackageSet (Prod r) -> PackageFetcher -> PackageSet (Prod (PackageFetcher : r))

-- | A synonym of <a>fetchGitHub</a> and <a>sourceGitHub</a>
fromGitHub :: PackageSet (Prod r) -> (Text, Text) -> PackageSet (Prod (PackageFetcher : (VersionSource : r)))

-- | A synonym of <a>fetchPypi</a> and <a>sourcePypi</a>
fromPypi :: PackageSet (Prod r) -> Text -> PackageSet (Prod (PackageFetcher : (VersionSource : r)))

-- | This package follows the latest github release
sourceGitHub :: PackageSet (Prod r) -> (Text, Text) -> PackageSet (Prod (VersionSource : r))

-- | This package follows the latest git commit
sourceGit :: PackageSet (Prod r) -> Text -> PackageSet (Prod (VersionSource : r))

-- | This package follows the latest pypi release
sourcePypi :: PackageSet (Prod r) -> Text -> PackageSet (Prod (VersionSource : r))

-- | This package follows the version of an Aur package
sourceAur :: PackageSet (Prod r) -> Text -> PackageSet (Prod (VersionSource : r))

-- | This package follows the version of an Arch Linux package
sourceArchLinux :: PackageSet (Prod r) -> Text -> PackageSet (Prod (VersionSource : r))

-- | This package follows a pinned version
sourceManual :: PackageSet (Prod r) -> Text -> PackageSet (Prod (VersionSource : r))

-- | This package follows the version of a repology package
sourceRepology :: PackageSet (Prod r) -> (Text, Text) -> PackageSet (Prod (VersionSource : r))

-- | This package is fetched from a github repo
fetchGitHub :: PackageSet (Prod r) -> (Text, Text) -> PackageSet (Prod (PackageFetcher : r))

-- | This package is fetched from a file in github release
fetchGitHubRelease :: PackageSet (Prod r) -> (Text, Text, Text) -> PackageSet (Prod (PackageFetcher : r))

-- | This package is fetched from pypi
fetchPypi :: PackageSet (Prod r) -> Text -> PackageSet (Prod (PackageFetcher : r))

-- | This package is fetched from git
fetchGit :: PackageSet (Prod r) -> Text -> PackageSet (Prod (PackageFetcher : r))

-- | This package is fetched from url
fetchUrl :: PackageSet (Prod r) -> (Version -> Text) -> PackageSet (Prod (PackageFetcher : r))

-- | Simple HList
data Prod (r :: [Type])
[Nil] :: Prod '[]
[Cons] :: !x -> Prod xs -> Prod (x : xs)

-- | Project elements from <a>Prod</a>
class Member (a :: Type) (r :: [Type])
proj :: Member a r => Prod r -> a

-- | Constraint for producing error messages
type family NotElem (x :: Type) (xs :: [Type]) :: Constraint
instance Development.NvFetcher.PackageSet.PkgDSL Development.NvFetcher.PackageSet.PackageSet
instance Development.NvFetcher.PackageSet.NotElem x xs => Development.NvFetcher.PackageSet.Member x (x : xs)
instance Development.NvFetcher.PackageSet.Member x xs => Development.NvFetcher.PackageSet.Member x (_y : xs)
instance (TypeError ...) => Development.NvFetcher.PackageSet.Member x '[]
instance GHC.Base.Functor Development.NvFetcher.PackageSet.PackageSetF

module Development.NvFetcher

-- | Rules of nvfetcher
nvfetcherRules :: Rules ()

-- | Main action, given a set of packages, generating nix sources expr in a
--   file
generateNixSources :: FilePath -> [Package] -> Action ()

-- | Arguments for running nvfetcher
data Args
Args :: (ShakeOptions -> ShakeOptions) -> FilePath -> Rules () -> Action () -> Args
[argShakeOptions] :: Args -> ShakeOptions -> ShakeOptions
[argOutputFilePath] :: Args -> FilePath
[argRules] :: Args -> Rules ()
[argActionAfterBuild] :: Args -> Action ()

-- | Default arguments of <a>defaultMain</a>
defaultArgs :: Args

-- | Entry point of nvfetcher
defaultMain :: Args -> PackageSet () -> IO ()

-- | Like <a>defaultMain</a> but allows to define custom cli flags
defaultMainWith :: [OptDescr (Either String a)] -> ([a] -> IO (Args, PackageSet ())) -> IO ()

-- | Record version changes between runs, relying on shake database
data VersionChange
VersionChange :: PackageName -> Maybe Version -> Version -> VersionChange
[vcName] :: VersionChange -> PackageName
[vcOld] :: VersionChange -> Maybe Version
[vcNew] :: VersionChange -> Version

-- | Get version changes. Use this function in <a>argActionAfterBuild</a>
--   to produce external changelog
getVersionChanges :: Action [VersionChange]
instance GHC.Classes.Eq Development.NvFetcher.VersionChange
instance GHC.Show.Show Development.NvFetcher.VersionChange
